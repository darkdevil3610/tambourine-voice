# Security group rules for TURN server
# Opens all required ports for WebRTC TURN functionality

Resources:
  # TURN protocol ports (UDP and TCP)
  sgturn3478udp:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      GroupId: {"Fn::GetAtt": ["AWSEBSecurityGroup", "GroupId"]}
      IpProtocol: udp
      FromPort: 3478
      ToPort: 3478
      CidrIp: 0.0.0.0/0

  sgturn3478tcp:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      GroupId: {"Fn::GetAtt": ["AWSEBSecurityGroup", "GroupId"]}
      IpProtocol: tcp
      FromPort: 3478
      ToPort: 3478
      CidrIp: 0.0.0.0/0

  # TURNS (TLS) port
  sgturns5349tcp:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      GroupId: {"Fn::GetAtt": ["AWSEBSecurityGroup", "GroupId"]}
      IpProtocol: tcp
      FromPort: 5349
      ToPort: 5349
      CidrIp: 0.0.0.0/0

  # Media relay ports (UDP)
  # WebRTC uses these ports for relaying media through the TURN server
  sgrelay:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      GroupId: {"Fn::GetAtt": ["AWSEBSecurityGroup", "GroupId"]}
      IpProtocol: udp
      FromPort: 49152
      ToPort: 65535
      CidrIp: 0.0.0.0/0
